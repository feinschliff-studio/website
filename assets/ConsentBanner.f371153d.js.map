{"version":3,"file":"ConsentBanner.f371153d.js","sources":["../../src/components/ConsentBanner.ts"],"sourcesContent":["import { createElement as h } from '.';\nimport { CustomElement } from './CustomElement';\nimport style from './../styles/components/consent-banner.pcss?inline';\n\ninterface Cookies extends Record<string, string> {\n    consent?: string;\n}\n\nexport class ConsentBanner extends CustomElement {\n    private consentBanner: HTMLDivElement;\n\n    public static getTagName(): string {\n        return 'consent-banner';\n    }\n\n    public get acceptLabel(): string {\n        return this.getAttribute('accept-label') || 'Accept';\n    }\n\n    public get declineLabel(): string {\n        return this.getAttribute('decline-label') || 'Decline';\n    }\n\n    public get toggleAttributeName(): string {\n        return this.getAttribute('toggle-attribute') || 'data-consent-toggle';\n    }\n\n    protected render(shadow: ShadowRoot): void | Promise<void> {\n        this.initializeConsentToggles();\n\n        const acceptButton = h(\n            'button',\n            {\n                class: [\n                    'consent-banner__action',\n                    'consent-banner__action--accept',\n                ],\n            },\n            [this.acceptLabel],\n        );\n        const declineButton = h(\n            'button',\n            {\n                class: [\n                    'consent-banner__action',\n                    'consent-banner__action--decline',\n                ],\n            },\n            [this.declineLabel],\n        );\n        acceptButton.addEventListener('click', this.handleAccept.bind(this));\n        declineButton.addEventListener('click', this.handleDecline.bind(this));\n\n        this.consentBanner = h(\n            'div',\n            {\n                class: 'consent-banner',\n            },\n            [\n                h(\n                    'article',\n                    {\n                        class: 'consent-banner__content',\n                    },\n                    [\n                        h(\n                            'div',\n                            {\n                                class: 'consent-banner__text',\n                            },\n                            [\n                                h('slot', {}, [\n                                    'Consent info should appear here',\n                                ]),\n                            ],\n                        ),\n                        h(\n                            'footer',\n                            {\n                                class: 'consent-banner__actions',\n                            },\n                            [acceptButton, declineButton],\n                        ),\n                    ],\n                ),\n            ],\n        );\n\n        shadow.appendChild(this.consentBanner);\n\n        consent.addEventListener('change', ({ detail }: ConsentChangeEvent) => {\n            switch (detail.level) {\n                case 2:\n                    this.consentBanner.classList.add(\n                        'consent-banner--consent-given',\n                    );\n                    this.consentBanner.classList.remove(\n                        'consent-banner--consent-denied',\n                    );\n                    break;\n\n                case 1:\n                    this.consentBanner.classList.add(\n                        'consent-banner--consent-denied',\n                    );\n                    this.consentBanner.classList.remove(\n                        'consent-banner--consent-given',\n                    );\n                    break;\n\n                default:\n                    this.consentBanner.classList.remove(\n                        'consent-banner--consent-given',\n                    );\n                    this.consentBanner.classList.remove(\n                        'consent-banner--consent-denied',\n                    );\n            }\n        });\n\n        consent.load();\n    }\n\n    private handleAccept(): void {\n        consent.level = 2;\n    }\n\n    private handleDecline(): void {\n        consent.level = 1;\n    }\n\n    private handleReset(): void {\n        consent.level = 0;\n    }\n\n    private initializeConsentToggles(): void {\n        const toggles = Array.from(\n            document.querySelectorAll(`[${this.toggleAttributeName}]`),\n        );\n\n        for (const toggle of toggles) {\n            toggle.addEventListener('click', this.handleReset.bind(this));\n        }\n    }\n\n    protected styles(): string | Promise<string> {\n        return style;\n    }\n}\n\nexport type ConsentChangeEvent = CustomEvent<{\n    level: number;\n}>;\n\nclass Consent extends EventTarget {\n    private _level: number | undefined;\n\n    get level(): number {\n        if (!this._level) {\n            this.load();\n        }\n\n        return this._level;\n    }\n\n    set level(level: number) {\n        this._level = level;\n        window.document.cookie = [\n            `consent=${level || ''}`,\n            `Max-Age=${level > 0 ? 31536000 : 0}`,\n            'SameSite=strict',\n        ].join('; ');\n\n        this.dispatchEvent(\n            new CustomEvent('change', {\n                detail: { level },\n            }) as ConsentChangeEvent,\n        );\n    }\n\n    public load(): void {\n        const cookies: Cookies = window.document.cookie\n            .split(';')\n            .map((value) => value.split('='))\n            .reduce(\n                (carry, [key, value]) => ({\n                    ...carry,\n                    [decodeURIComponent(key.trim())]: decodeURIComponent(\n                        value?.trim(),\n                    ),\n                }),\n                {},\n            );\n\n        this.level = Number(cookies.consent || 0);\n    }\n}\n\nexport const consent = new Consent();\n"],"names":["ConsentBanner","CustomElement","__publicField","shadow","acceptButton","h","declineButton","consent","detail","toggles","toggle","style","Consent","level","cookies","value","carry","key"],"mappings":"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"}